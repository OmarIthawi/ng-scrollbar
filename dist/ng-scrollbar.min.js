/**
 * ng-scrollbar
 * @version v0.0.1 - 2014-05-25
 * @link https://github.com/asafdav/ng-scrollbar
 * @author Asaf David <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("ngScrollbar",[]).directive("ngScrollbar",["$parse","$window",function(a,b){return{restrict:"A",replace:!0,transclude:!0,scope:{onScroll:"&"},link:function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q={pageUp:{keyCode:33,offsetY:-340},pageDown:{keyCode:34,offsetY:340},up:{keyCode:38,offsetY:-10},down:{keyCode:40,offsetY:10}},r={bottom:d.hasOwnProperty("bottom")},s=angular.element(b),t={top:0},u={top:0},v=function(){k={position:"relative",overflow:"hidden","max-width":"100%",height:"100%"},u.height&&(k.height=u.height+"px"),l={position:"absolute",height:t.height+"px",top:t.top+"px"},m={position:"relative","line-height":t.height+"px"},n={position:"relative",top:u.top+"px",overflow:"hidden"}},w=function(){h.css("top",t.top+"px");var a=t.top/u.height;u.top=-Math.round(u.scrollHeight*a),f.css("top",u.top+"px")},x=function(b){var c=b.hasOwnProperty("offsetY")?b.offsetY:b.layerY,d=Math.max(0,Math.min(parseInt(t.trackHeight,10)-parseInt(t.height,10),c));a.onScroll({$event:{type:"scrollbarClickScroll"}}),t.top=d,w(),b.stopPropagation()},y=function(b){var c=20,d=void 0!==b.wheelDeltaY?b.wheelDeltaY/c:void 0!==b.wheelDelta?b.wheelDelta/c:-b.detail*(c/10);return t.top=Math.max(0,Math.min(parseInt(u.height,10)-parseInt(t.height,10),parseInt(t.top,10)-d)),a.onScroll({$event:{type:"wheelScroll"}}),w(),b.preventDefault?void b.preventDefault():!1},z=function(a,b,c){t.top=Math.max(0,Math.min(parseInt(t.trackHeight,10)-parseInt(t.height,10),c)),a.stopPropagation()},A=function(a){var b=a.pageY-h[0].scrollTop-o,c=0;z(a,c,b),w()},B=function(b,c){t.top=Math.max(0,Math.min(parseInt(t.trackHeight,10)-parseInt(t.height,10),t.top+c)),a.onScroll({$event:{type:b+"ScrollKeypress"}}),w()},C=function(b){var d=c[0].parentElement.offsetTop,p=void 0!==s[0].onmousewheel?"mousewheel":"DOMMouseScroll";b=r.bottom||b,e=angular.element(c.children()[0]),f=angular.element(e.children()[0]),g=angular.element(e.children()[1]),h=angular.element(angular.element(g.children()[0]).children()[0]),i=angular.element(h.children()[0]),j=angular.element(angular.element(g.children()[0]).children()[1]),u.height=c[0].offsetHeight-d,u.scrollHeight=f[0].scrollHeight,u.height<u.scrollHeight?(a.showYScrollbar=!0,t.height=Math.round(u.height/u.scrollHeight*u.height),t.trackHeight=u.height,v(),c.css({overflow:"hidden"}),e.css(k),f.css(n),h.css(l),i.css(m),j.bind("click",x),f[0].addEventListener(p,y,!1),h.on("mousedown",function(b){o=b.pageY-h[0].offsetTop;var c=+new Date;a.onScroll({$event:{type:"scrollbarMousedown"}}),s.on("mouseup",function(){a.onScroll({$event:{type:"scrollbarMouseup",durationMs:+new Date-c}}),s.off("mousemove",A),b.stopPropagation()}),s.on("mousemove",A),b.preventDefault()}),angular.forEach(q,function(b,c){var d=null;s.on("keydown",function(a){a.keyCode===b.keyCode&&(d||(d=+new Date),B(c,b.offsetY),a.preventDefault())}),s.on("keyup",function(e){if(e.keyCode===b.keyCode){if(d){var f=+new Date-d;d=null,a.onScroll({$event:{type:c+"ScrollKeyup",durationMs:f}})}e.preventDefault()}})}),b?(r.bottom=!1,t.top=parseInt(u.height,10)-parseInt(t.height,10)):t.top=Math.max(0,Math.min(parseInt(u.height,10)-parseInt(t.height,10),parseInt(t.top,10))),w()):(a.showYScrollbar=!1,h.off("mousedown"),s.off("keydown"),s.off("keypress"),s.off("keyup"),f[0].removeEventListener(p,y,!1),f.attr("style","position:relative;top:0"),e.css({height:"100%"}))},D=function(b,c){null!=p&&clearTimeout(p);var d=!!c&&!!c.rollToBottom;p=setTimeout(function(){u.height=null,C(d),a.$$phase||a.$digest()},72)};C(),d.rebuildOn&&d.rebuildOn.split(" ").forEach(function(b){a.$on(b,D)}),d.hasOwnProperty("rebuildOnResize")&&s.on("resize",D)},template:'<div><div class="ngsb-wrap"><div class="ngsb-container" ng-transclude></div><div class="ngsb-scrollbar" style="position: absolute; display: block;" ng-show="showYScrollbar"><div class="ngsb-thumb-container"><div class="ngsb-thumb-pos" oncontextmenu="return false;"><div class="ngsb-thumb" ></div></div><div class="ngsb-track"></div></div></div></div></div>'}}]);